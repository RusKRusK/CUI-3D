#include <stdio.h>
#include <stdlib.h>
#include <termios.h> //キー入力関係
#include <unistd.h>  //キー入力関係
#include <fcntl.h>   //キー入力関係
#include <stdbool.h>
#include <string.h>
#include <vector>
#include <math.h>

#define ToRad(x) (double)(x)*(M_PI / 180.0)
#define Dep(m, n) n/(1.001 - m)
#define V_RAD 3.0

struct vec2{
    double x;
    double y;
};

struct Player{
    double x;
    double y;
    double z;
    int deg;
};

struct Player plr;

double dir_rad[] = {0, -M_PI/2, M_PI, M_PI/2};

//描画するイラストを変更する場合はこの配列の宣言を書き換える。
//paint.cppで作成した場合、二次元配列でエクスポートして、名前を「canvas」にした後そのまま貼り付ければOK
//元々ある方のcanvasの宣言は削除する
int canvas[64][64] = {{23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,52,175,175,175,219,219,219,52,23,23,23,23,23,23,23,23,52,254,9,254,52,52,9,9,9,1,1,1,204,204,52,23,23,23,23,23,23,23,23,23,23,23,23,23,23},
{23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,52,169,175,175,219,219,219,219,219,52,52,52,52,52,52,52,52,249,254,9,254,254,254,52,9,1,1,1,1,204,204,52,23,23,23,23,23,23,23,23,23,23,23,23,23,23},
{23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,52,169,175,175,219,219,52,52,52,52,231,231,231,231,231,231,231,52,249,9,254,249,249,254,254,52,52,1,1,1,1,204,52,23,23,23,23,23,23,23,23,23,23,23,23,23,23},
{23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,52,169,175,175,52,52,52,219,219,219,219,219,219,219,225,225,219,52,249,249,52,52,52,52,52,254,254,254,52,52,52,52,52,52,52,23,23,23,23,23,23,23,23,23,23,23,23,23},
{23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,52,169,52,52,175,219,219,219,219,219,219,225,225,219,219,169,52,52,52,52,225,225,225,225,225,52,52,249,254,254,254,254,254,9,254,52,52,23,23,23,23,23,23,23,23,23,23,23},
{23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,52,52,52,175,175,175,219,225,225,225,219,225,219,225,225,169,52,225,225,225,225,225,225,225,225,225,225,231,52,249,254,254,254,9,254,254,254,52,23,23,23,23,23,23,23,23,23,23,23},
{23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,52,175,175,175,175,219,225,225,225,225,225,225,219,225,225,52,225,225,52,52,52,225,225,225,225,225,225,225,231,52,249,254,254,9,254,254,52,23,23,23,23,23,23,23,23,23,23,23,23},
{52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,175,175,52,52,52,52,225,225,225,225,225,225,225,225,225,225,225,52,169,169,169,52,52,225,225,225,225,225,225,231,52,254,9,254,249,52,23,23,23,23,23,23,23,23,23,23,23,23,23},
{9,9,9,9,204,204,204,204,204,204,204,204,204,204,204,52,52,225,225,225,225,52,52,52,225,225,225,225,225,225,225,126,169,169,169,169,169,126,52,225,225,225,225,225,225,231,52,9,249,52,23,23,23,23,23,23,23,23,23,23,23,23,23,23},
{52,52,9,9,9,9,204,204,204,204,204,204,204,204,52,225,225,225,225,225,225,225,225,225,225,225,225,225,52,52,52,52,52,52,52,52,52,126,126,52,225,219,219,225,225,225,231,52,249,52,23,23,23,23,23,23,23,23,23,23,23,23,23,23},
{1,1,52,52,9,9,9,9,9,9,9,9,9,52,225,225,225,225,225,52,52,225,225,225,225,52,52,52,9,9,9,9,9,9,9,9,9,52,52,52,52,225,225,219,225,225,225,231,52,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23},
{1,1,1,1,52,52,9,9,9,9,9,9,52,219,225,225,225,225,52,169,169,225,52,52,52,9,9,9,9,9,9,9,9,9,9,9,9,9,1,1,1,52,219,225,219,225,225,225,231,52,169,169,169,23,23,23,23,23,23,23,23,23,23,23},
{1,1,1,1,1,1,52,52,9,9,9,52,219,219,225,225,225,52,126,169,52,52,9,9,9,9,9,9,9,9,9,9,9,52,52,52,52,9,9,9,1,1,52,219,225,219,225,225,225,231,52,23,23,169,23,23,23,23,23,23,23,23,23,121},
{1,1,1,1,1,1,1,1,52,52,9,52,219,225,225,225,52,126,126,52,1,9,9,9,9,9,9,52,52,52,52,52,52,225,225,225,225,52,52,52,52,52,52,52,219,225,219,225,225,225,231,52,23,23,169,23,23,23,23,23,121,121,121,121},
{52,1,1,1,1,1,1,1,1,1,52,219,219,225,225,225,52,126,52,1,1,9,9,9,52,52,52,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,219,52,219,225,225,225,225,225,231,52,23,23,169,23,121,121,121,121,121,121,121},
{23,52,1,1,1,1,1,1,1,1,52,219,225,225,225,225,52,52,1,1,9,9,52,52,225,225,225,225,225,225,225,225,225,225,52,219,225,225,225,225,225,225,225,225,219,52,219,231,231,225,225,225,231,52,121,121,169,121,121,121,121,121,121,121},
{23,52,1,1,1,1,1,1,1,52,219,219,225,225,225,52,1,1,1,1,52,52,225,225,225,225,225,225,225,225,225,225,225,225,225,52,219,225,225,225,225,225,225,225,225,219,52,219,231,231,225,225,225,231,52,121,169,121,121,121,121,121,121,121},
{23,23,52,1,1,1,1,1,1,52,219,225,225,225,225,52,1,1,1,52,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,52,52,225,225,231,225,225,231,225,231,225,219,52,219,231,231,225,225,225,52,121,121,169,121,121,121,121,121,121},
{23,23,23,52,1,1,1,1,52,219,219,225,225,225,225,52,1,1,52,225,225,225,225,225,219,225,225,225,225,225,225,225,225,225,225,52,216,52,225,231,231,225,231,52,231,231,225,219,52,219,231,225,225,225,225,52,121,169,121,121,121,121,121,121},
{23,23,23,52,1,1,1,1,52,219,225,225,231,225,52,1,1,52,225,225,225,225,225,219,219,225,225,225,225,225,231,231,225,231,231,52,216,216,52,225,231,225,231,231,52,231,225,219,52,219,225,225,225,225,225,52,121,121,169,121,121,121,121,121},
{23,23,23,23,52,1,1,1,52,219,225,225,231,231,52,1,52,225,225,231,231,225,225,219,52,225,225,225,225,231,231,231,225,231,231,231,52,216,216,52,225,169,169,169,169,52,225,225,219,52,219,225,225,225,225,231,52,121,169,121,121,121,121,121},
{23,23,23,23,23,52,1,52,219,219,225,231,231,231,52,52,225,225,225,231,231,231,231,52,52,231,231,231,225,231,231,231,231,231,231,231,52,216,216,169,169,219,219,219,52,52,225,225,219,52,219,225,225,225,225,231,52,121,169,121,121,121,121,121},
{23,23,23,23,23,52,1,52,219,225,225,231,231,231,52,169,225,225,231,231,231,231,52,216,52,231,231,231,225,231,231,231,225,231,231,231,52,216,169,216,216,52,219,219,52,216,52,225,225,219,52,219,225,225,225,225,231,52,169,121,121,121,121,121},
{23,23,23,23,23,23,52,52,219,225,231,231,231,52,169,169,225,225,231,225,225,225,52,216,52,231,231,231,225,225,219,219,219,219,219,225,52,230,230,230,230,216,52,219,52,216,52,225,225,219,52,219,225,225,225,225,231,52,121,121,121,121,121,121},
{23,23,23,23,23,23,23,52,219,225,225,225,231,52,169,169,225,225,52,225,225,225,52,216,52,231,231,219,219,219,219,219,219,219,225,225,52,230,230,230,230,230,52,219,52,216,216,52,225,52,219,52,219,219,225,225,225,231,52,121,121,121,121,121},
{23,23,23,23,23,23,52,219,219,225,225,225,225,52,169,225,225,225,52,225,225,225,52,216,52,219,219,219,219,219,225,219,219,219,225,52,230,230,230,230,230,230,52,219,52,230,230,52,225,52,219,52,219,219,225,225,225,231,52,121,121,121,121,121},
{23,23,23,23,23,23,52,219,225,225,225,225,225,52,169,225,225,225,52,225,225,169,169,169,169,169,169,219,225,219,225,219,219,219,225,52,230,230,230,230,230,230,52,52,230,230,230,52,225,52,219,219,52,219,219,225,225,225,231,52,121,121,121,121},
{23,23,23,23,23,23,52,219,225,225,225,225,225,52,169,225,225,225,52,169,169,219,52,230,230,52,219,219,225,225,225,219,219,225,225,52,230,230,230,230,230,223,52,223,223,230,230,52,52,230,52,219,52,219,219,219,219,225,231,52,121,121,121,121},
{23,23,23,23,23,169,52,219,225,225,225,225,225,52,169,225,225,52,216,52,219,219,52,230,230,230,52,219,219,225,225,219,219,225,52,230,230,230,230,230,223,16,16,16,16,16,223,52,230,230,52,219,219,52,219,219,219,225,225,231,52,121,121,121},
{23,23,23,23,23,169,52,219,225,225,225,225,225,52,169,225,225,52,216,52,219,219,52,230,230,230,52,219,219,225,225,219,219,225,52,230,230,230,230,223,16,16,16,16,16,16,16,16,230,230,230,52,219,52,219,219,219,225,225,231,52,121,121,121},
{23,23,23,23,169,121,52,219,225,225,225,225,225,52,169,225,225,52,216,216,52,219,52,230,230,230,230,52,219,225,225,219,225,52,230,230,230,230,230,16,16,251,88,88,88,251,251,16,16,230,230,52,219,169,52,219,219,219,225,225,231,52,121,121},
{23,121,121,121,169,121,52,219,225,225,225,225,52,169,225,225,225,52,216,230,230,52,219,52,230,230,230,230,52,219,225,225,225,52,230,230,230,230,230,16,251,88,171,225,206,88,251,251,16,16,230,230,16,169,52,219,219,219,225,225,225,52,121,121},
{121,121,121,121,169,121,52,219,225,225,225,225,52,169,225,225,225,52,230,230,230,230,52,52,223,223,223,223,230,52,225,225,52,230,230,230,230,230,230,255,88,171,171,225,231,231,125,251,251,16,16,230,16,169,169,52,219,219,225,225,225,225,52,121},
{121,121,121,121,169,121,52,219,225,225,225,225,52,169,225,225,219,52,52,230,230,223,223,16,16,16,16,16,223,230,52,225,52,230,230,230,230,230,230,255,206,225,225,206,231,231,125,254,251,233,16,230,16,169,167,52,219,219,225,219,225,225,52,121},
{121,121,121,121,169,121,52,219,225,225,225,225,52,169,225,225,219,52,52,230,223,16,16,16,16,16,16,16,16,230,230,52,230,230,230,230,230,230,230,255,213,206,206,206,206,206,206,254,254,233,233,230,16,167,167,52,219,219,225,219,219,225,52,121},
{121,121,121,121,169,121,52,219,225,52,225,225,52,225,225,219,219,52,230,52,16,16,16,251,88,225,88,251,16,16,230,52,230,230,230,230,230,230,230,255,231,231,225,213,225,225,219,254,254,233,234,230,16,167,167,167,52,219,225,219,219,219,52,121},
{121,121,121,121,121,52,225,225,225,52,225,225,52,225,225,219,219,52,230,230,16,16,251,88,171,171,231,231,251,255,230,230,230,230,230,230,230,230,230,255,255,213,225,219,225,219,254,254,254,234,230,230,16,16,16,167,52,219,225,219,219,219,52,121},
{121,121,121,121,121,52,225,225,225,52,225,225,52,225,225,52,219,52,230,16,16,250,125,171,171,206,231,231,125,255,230,230,230,230,230,230,230,230,230,230,255,255,219,219,219,219,254,239,230,230,230,230,16,180,180,16,52,219,219,219,219,219,52,121},
{121,121,121,121,121,52,225,225,225,52,225,225,52,175,225,52,219,52,230,233,250,250,206,225,225,206,224,206,171,255,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,16,180,180,180,16,219,219,219,219,219,52,121},
{121,121,121,121,52,52,219,225,225,52,225,225,52,175,175,175,52,216,233,233,250,254,213,213,206,206,206,224,206,255,230,230,230,230,230,230,231,231,230,230,230,230,230,230,230,224,224,217,224,217,230,230,230,16,180,180,180,16,219,219,219,219,219,52},
{121,121,121,52,225,52,219,225,225,52,225,225,225,52,175,175,52,216,233,233,254,231,231,231,225,206,225,225,225,255,230,230,230,230,230,230,231,231,230,230,230,230,230,230,223,224,217,224,217,224,217,230,230,16,180,180,180,16,219,219,219,219,219,52},
{121,121,121,52,225,52,219,219,225,225,52,225,225,52,175,175,52,216,234,233,254,254,219,225,225,219,225,206,255,230,230,230,230,230,230,230,180,230,230,230,230,230,230,230,223,217,224,217,224,217,224,230,16,180,223,223,180,180,16,219,219,219,219,52},
{121,121,52,225,225,52,219,219,225,225,52,225,225,52,175,169,169,52,230,234,255,255,254,254,219,219,219,255,255,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,223,217,224,217,224,217,230,16,223,223,223,223,180,16,219,219,219,219,52},
{121,52,225,225,225,52,219,219,219,225,52,225,225,52,169,169,169,52,230,230,236,255,255,255,255,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,223,230,230,230,223,223,223,223,230,16,223,223,223,223,223,223,16,219,219,219,219,52},
{121,52,225,225,225,169,52,219,219,225,52,225,225,225,52,169,169,169,52,230,230,230,239,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,223,230,230,230,230,230,230,230,230,230,16,223,223,223,223,223,223,16,219,219,219,52,121},
{52,225,225,169,169,169,52,219,219,225,52,219,225,219,52,169,169,16,16,230,230,230,230,217,224,217,224,217,230,230,223,223,230,230,230,230,230,230,230,230,230,223,230,230,230,230,230,230,230,230,16,223,223,223,223,223,223,223,16,219,219,219,52,121},
{225,225,169,169,169,169,52,219,219,225,52,219,219,219,52,169,16,180,180,16,230,217,217,224,217,224,217,224,230,230,230,230,223,230,230,230,230,230,230,230,180,223,230,230,230,230,230,230,230,230,16,223,223,223,223,223,223,223,16,219,219,219,52,121},
{225,225,225,169,169,169,52,219,219,225,225,52,219,219,52,169,16,180,180,16,230,217,224,217,224,217,223,223,230,230,230,230,230,223,230,230,230,230,230,216,230,223,230,230,230,230,230,230,230,230,16,223,223,223,223,223,223,223,16,219,219,219,52,121},
{225,225,169,169,169,169,169,52,219,219,225,52,219,219,219,52,180,180,180,16,230,230,230,230,223,223,217,230,230,230,230,230,230,230,180,216,216,216,216,230,230,230,230,230,230,230,230,230,230,230,16,223,223,223,223,223,223,223,16,219,219,52,121,121},
{225,169,169,169,169,169,169,52,219,219,225,52,219,219,219,52,180,180,180,180,16,230,230,230,230,230,230,230,230,230,230,230,230,230,223,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,16,223,223,223,223,223,223,223,16,219,219,52,121,121},
{169,169,169,169,169,169,52,52,219,169,225,225,52,219,219,52,180,180,223,223,223,16,16,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,16,223,223,223,223,223,223,223,223,223,16,219,52,121,121},
{169,169,169,169,169,52,121,52,169,169,169,225,52,219,219,219,52,223,223,223,223,223,223,16,230,230,230,230,216,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,16,16,223,223,223,223,223,223,223,223,223,223,16,121,121,121},
{169,169,169,52,52,121,121,121,52,169,169,225,225,52,219,219,52,223,223,223,223,223,223,223,16,230,230,230,216,230,216,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,16,16,216,16,223,223,223,223,223,223,223,223,223,223,16,121,121},
{52,52,52,121,121,121,121,121,52,169,169,169,225,225,52,219,219,52,223,223,223,223,223,223,223,16,230,230,230,216,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,16,245,16,216,216,16,223,223,223,223,223,223,223,223,223,223,16,121},
{121,121,121,121,121,121,121,121,52,169,169,169,169,225,225,52,219,219,52,223,223,223,223,223,223,16,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,16,16,245,16,216,216,216,223,216,223,223,223,223,223,223,223,223,223,16},
{121,121,121,121,121,121,121,121,121,52,169,169,169,169,225,225,52,219,219,52,223,223,223,52,223,223,16,16,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,16,216,216,16,245,16,216,223,216,223,216,223,223,223,223,223,223,223,223,223},
{121,121,121,121,121,121,121,121,121,52,169,169,169,169,225,225,225,52,219,219,52,52,52,223,223,223,16,223,16,16,16,16,16,230,230,230,230,230,230,230,230,230,16,16,216,216,216,16,245,16,216,216,223,216,223,216,223,223,223,223,223,223,223,223},
{121,121,121,121,121,121,121,121,121,121,52,169,169,169,169,225,225,16,52,52,223,223,223,223,223,223,16,223,223,16,180,180,180,0,0,0,0,0,0,0,0,0,180,180,216,216,216,52,245,245,16,216,216,223,216,223,216,223,223,223,223,223,223,223},
{121,121,121,121,121,121,121,121,121,121,121,52,169,169,169,169,225,225,16,223,223,223,223,223,223,223,16,223,223,16,180,180,180,180,180,180,180,180,180,180,180,180,180,216,216,216,52,88,52,245,252,16,16,216,223,216,223,216,223,223,223,223,223,223},
{121,121,121,121,121,121,121,121,121,121,121,121,52,169,169,169,169,169,16,223,223,223,223,223,223,16,223,223,223,16,180,180,180,180,180,180,180,180,180,180,216,216,216,216,216,216,52,88,52,251,252,252,252,16,216,223,216,223,216,223,223,223,223,223},
{121,121,121,121,121,121,121,121,121,121,121,121,121,52,169,169,169,16,223,223,223,223,223,223,223,223,223,223,223,16,180,180,180,180,180,180,180,180,216,216,216,216,216,216,216,52,88,88,52,88,252,252,252,252,16,216,223,216,223,216,223,223,223,223},
{121,121,121,121,121,121,121,121,121,121,121,121,121,121,52,169,169,16,223,223,223,223,223,223,223,223,223,223,16,88,52,180,180,180,216,216,216,216,216,216,216,216,216,216,52,88,88,52,88,88,252,252,252,252,252,16,216,223,216,223,216,223,223,223},
{121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,52,16,223,223,223,223,223,223,223,223,223,223,223,16,88,88,52,52,52,216,216,216,216,216,216,216,216,216,52,88,88,88,52,252,88,88,252,252,252,252,252,16,216,216,216,223,216,223,223},
{121,121,121,121,121,121,121,121,121,121,121,121,121,121,121,16,223,223,223,223,223,223,223,223,223,223,223,16,252,52,88,88,88,88,52,52,52,216,216,216,216,52,52,88,88,88,52,252,252,88,88,252,252,252,252,252,252,16,216,216,216,223,216,223}};

int field_h = sizeof(canvas) / sizeof(canvas[0]);
int field_w = sizeof(canvas[0]) / sizeof(canvas[0][0]);

void setBufferedInput(bool);
void Init(void);
vec2 addvec(vec2, vec2);
vec2 vecmulti(double, vec2);

void setBufferedInput(bool enable){
    static bool enabled = true;
    static struct termios old;
    struct termios new_;
    if (enable && !enabled){
        tcsetattr(STDIN_FILENO, TCSANOW, &old);
        enabled = true;
    }
    else if (!enable && enabled){
        tcgetattr(STDIN_FILENO, &new_);
        old = new_;
        new_.c_lflag &= (~ICANON & ~ECHO);
        tcsetattr(STDIN_FILENO, TCSANOW, &new_);
        enabled = false;
    }
}

void Init(void){
    system("clear");
    plr.x = field_w/2;
    plr.y = field_h + 10;
    plr.z = 4;
    plr.deg = -90;
    setBufferedInput(false);
}

vec2 vecadd(vec2 u, vec2 v){
    vec2 w;
    w.x = u.x + v.x;
    w.y = u.y + v.y;
    return w;
}

vec2 vecmulti(double k, vec2 u){
    vec2 v;
    v.x = k * u.x;
    v.y = k * u.y;
    return v;
}

void drow(void){
    printf("\e[0;0H");
    vec2 vl, vr;
    vl.x =V_RAD * cos(ToRad(plr.deg - 45.0));
    vl.y =V_RAD * sin(ToRad(plr.deg - 45.0));
    vr.x =V_RAD * cos(ToRad(plr.deg + 45.0));
    vr.y =V_RAD * sin(ToRad(plr.deg + 45.0));
    for (double i = 1; i >= 0; i -= 0.0067){
        for (double j = 0; j < 1; j += 0.005){
            if(Dep(i, plr.z) > 70){
                printf("　");
                continue;
            }
            vec2 now = vecadd(vecmulti((1.0 - j) * Dep(i, plr.z), vl), vecmulti(j * Dep(i, plr.z), vr));
            if(plr.x + now.x >= 0&&
                plr.x + now.x < field_w&&
                plr.y + now.y >= 0&&
                plr.y + now.y < field_h)printf("\e[48;5;%dm　",canvas[(int)(plr.y + now.y)][(int)(plr.x + now.x)]);
            else printf("\e[0m　");
        }
        printf("\e[0m　");
        putchar('\n');
    }
    printf("\e[0J");
}

int main(void){
    Init();
    drow();
    int k;
    while(1){
        k=0;
        drow();
        switch(getchar()){
            case 'q':
                system("stty sane");
                return 0;
            case 'd':       //前進
                k++;
            case 's':       //左
                k++;
            case 'a':       //後退
                k++;
            case 'w':       //右
                    plr.x = plr.x + 0.25 * cos(ToRad(plr.deg) + dir_rad[k]);
                    plr.y = plr.y + 0.25 * sin(ToRad(plr.deg) + dir_rad[k]);
                break;
            case '4':       //前進
                k++;
            case '2':       //左
                k++;
            case '1':       //後退
                k++;
            case '3':       //右
                    plr.x = plr.x + 0.1 * cos(ToRad(plr.deg) + dir_rad[k]);
                    plr.y = plr.y + 0.1 * sin(ToRad(plr.deg) + dir_rad[k]);
                break;
            case 65:        //↑キー
                plr.z += 0.1;
                break;
            case 68:        //←キー
                plr.deg -= 2;
                break;
            case 66:        //↓キー
                plr.z -= 0.1;
                break;
            case 67:        //→キー
                plr.deg += 2;
                break;
        }
    }
    system("stty sane");
    return 0;
}